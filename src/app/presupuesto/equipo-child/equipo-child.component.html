<div class="row">
  <div class="cell">

    <button class="button primary m-2" (click)="f('#equipo_'+ubicacion.id)">Agregar Equipo</button>
  </div>
</div>
<div class="row">
  <div class="cell-10 offset-1">
    <div data-role="accordion" data-one-frame="false" data-show-active="false" data-active-heading-class="bg-pink fg-white">
      <div class="frame" *ngFor="let equipo of ubicacion.equipos">
        <div class="heading">{{equipo.nombre}}</div>
        <div class="content" style="display:none">
          <div class="row">
            <div class="cell">
              <div class="form-group">
                <label>Ubicación</label>
                <select [(ngModel)]="ubicacionSeleccionada" (change)="moverEquipo(equipo)">
                  <option *ngFor="let ubicacion of  ubicaciones" [ngValue]="ubicacion">
                    {{ubicacion.nombre}}
                  </option>

                </select>
              </div>
            </div>
            <div class="cell">
              <div class="form-group">
                <label>Precio</label>
                <input disabled type="text" value="{{equipo.precio | currency}}">
              </div>
            </div>
            <div class="cell">
              <div class="form-group">
                <label>Porc</label>
                <p-spinner (onChange)="actualizarTotal()" (keyup)="actualizarTotal()" size="30" [(ngModel)]="equipo.porcentaje"
                  [step]="0.25"></p-spinner>
              </div>
            </div>
            <div class="cell">
              <div class="form-group">
                <label>Precio final</label>
                <input disabled type="text" value="{{equipo.precio * equipo.porcentaje | currency}}">
              </div>
            </div>
            <div class="cell">
              <div class="form-group">
                <label>Total equipo + materiales</label>
                <input disabled type="text" value="{{equipo.total | currency}}">
              </div>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="cell">
              <button class="button primary m-2" (click)="f('#material_'+equipo.id)">Agregar Material</button>

            </div>
            <div class="cell">
              <div class="form-group">
                <label>Total materiales</label>
                <input type="text" disabled value="{{ totalMateriales(equipo) | currency}}">
              </div>
            </div>
            <div class="cell">
              <div class="form-group">
                <label>Total Personalizado</label>
                <input type="text" id="total_personalizado" (keyup)="actualizar_total_personalizado()" name="total_personalizado"
                  [(ngModel)]="equipo.total_materiales_modificado">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="cell">
              <table class="table compact striped">
                <thead>
                  <tr>
                    <th>código</th>
                    <th>nombre</th>
                    <th>precio</th>
                    <th>Porc</th>
                    <th>cantidad</th>
                    <th>total</th>
                    <th>Eliminar</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let material of equipo.materiales">
                    <td>{{material.codigo}}</td>
                    <td>{{material.nombre}}</td>
                    <td>{{material.precio}}</td>
                    <td>
                      <p-spinner (onChange)="actualizarTotal()" (keyup)="actualizarTotal()" size="10" [(ngModel)]="material.porcentaje"
                        [step]="0.25">
                      </p-spinner>
                    </td>
                    <td>
                      <p-spinner (onChange)="actualizarTotal()" (keyup)="actualizarTotal()" size="10" [(ngModel)]="material.cantidad"
                        [step]="1" min="1"></p-spinner>
                    </td>
                    <td>{{material.precio * material.cantidad * material.porcentaje | currency}}</td>
                    <td><span class="mif-bin mif-lg fg-red pointer" (click)="eliminarMaterial(equipo,material)"></span>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td>
                      Total
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>{{ totalMateriales(equipo) | currency}}</td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
        <div class="dialog" data-role="dialog" id="material_{{equipo.id}}" data-width="1000">
          <div class="dialog-title">Materiales</div>
          <div class="dialog-content">
            <div class="row">
              <div class="cell">
                <input type="text" placeholder="buscar">
              </div>
            </div>
            <div class="row">
              <div class="cell">
                <table class="table compact striped row-hover">
                  <thead>
                    <th>codigo</th>
                    <th>nombre</th>
                    <th>precio</th>
                    <th>cantidad</th>

                  </thead>
                  <tbody>
                    <tr *ngFor="let material of materiales_lista" (click)="agregarMaterial(material,equipo)" class="pointer">
                      <td>{{material.codigo}}</td>
                      <td>{{material.nombre}}</td>
                      <td>{{material.precio | currency}}</td>
                      <td>{{material.cantidad}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="dialog-actions">
            <button class="button js-dialog-close">Cerrar</button>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="dialog" data-role="dialog" id="equipo_{{ubicacion.id}}" data-width="1000">
  <div class="dialog-title">Equipos</div>
  <div class="dialog-content">
    <div class="row">
      <div class="cell">
        <input type="text" placeholder="buscar">
      </div>
    </div>
    <div class="row">
      <div class="cell">
        <table class="table compact striped row-hover">
          <thead>
            <th>codigo</th>
            <th>nombre</th>
            <th>precio</th>
            <th>capacidad</th>

          </thead>
          <tbody>
            <tr *ngFor="let equipo of equipos_lista" (click)="agregarEquipo(equipo)" class="pointer">
              <td>{{equipo.codigo}}</td>
              <td>{{equipo.nombre}}</td>
              <td>{{equipo.precio | currency}}</td>
              <td>{{equipo.capacidad}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="dialog-actions">
    <button class="button js-dialog-close">Cerrar</button>

  </div>
</div>